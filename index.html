<script type="text/babel">
    const { useState } = React;

    const App = () => {
        // ... stati esistenti ...
        const [view, setView] = useState('GAME');
        const [stats, setStats] = useState({ level: 1, gold: 500, dropCount: 0, STR: 10, DEX: 10 });
        const [equipment, setEquipment] = useState({});
        const [inventory, setInventory] = useState([]);
        const [logs, setLogs] = useState(["Pronto alla battaglia..."]);

        // Funzione Vendi Tutto
        const sellAllExceptFavorites = (favoritesSet) => {
            const toSell = inventory.filter(item => !favoritesSet.has(item.id));
            const totalGold = toSell.reduce((acc, item) => acc + item.sellPrice, 0);
            
            setInventory(prev => prev.filter(item => favoritesSet.has(item.id)));
            setStats(prev => ({ ...prev, gold: prev.gold + totalGold }));
            setLogs(prev => [`Venduti ${toSell.length} oggetti per ${totalGold}g`, ...prev]);
        };

        const sellItem = (item) => {
            setInventory(prev => prev.filter(i => i.id !== item.id));
            setStats(prev => ({ ...prev, gold: prev.gold + item.sellPrice }));
        };

        const handleEquip = (item) => {
            const old = equipment[item.slot];
            setEquipment(prev => ({ ...prev, [item.slot]: item }));
            setInventory(prev => {
                const filtered = prev.filter(i => i.id !== item.id);
                return old ? [...filtered, old] : filtered;
            });
        };

        // ... resto della logica dropLoot ...

        return (
            <div className="h-screen w-full flex flex-col items-center justify-center bg-zinc-950">
                <div className="text-yellow-600 text-xl mb-4">{logs[0]}</div>
                <div className="flex gap-4">
                    <button onClick={dropLoot} className="bg-red-950 border-2 border-red-700 px-8 py-4 text-xl">âš”ï¸ COMBATTI</button>
                    <button onClick={() => setView('INV')} className="bg-zinc-800 border-2 border-zinc-600 px-8 py-4 text-xl">ğŸ’ ZAINO</button>
                </div>
                
                {view === 'INV' && (
                    <EquipmentScreen 
                        stats={stats} 
                        equipment={equipment} 
                        inventory={inventory}
                        onEquip={handleEquip} 
                        onSell={sellItem} 
                        onSellAll={sellAllExceptFavorites}
                        onClose={() => setView('GAME')}
                    />
                )}
            </div>
        );
    };
    // ... render ...
</script>

<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Diablo Runner RPG</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="data/itemDB.js"></script>
    <script src="scripts/itemGenerator.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');
        body { background: #000; color: #eee; font-family: 'VT323', monospace; margin: 0; overflow: hidden; }
        .COMMON { color: #94a3b8; }
        .UNCOMMON { color: #4ade80; }
        .RARE { color: #3b82f6; }
        .EPIC { color: #a855f7; }
        .LEGENDARY { color: #fbbf24; text-shadow: 0 0 8px #fbbf24; }
        .SET { color: #22c55e; text-shadow: 0 0 10px #22c55e; font-weight: bold; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" src="scripts/EquipmentUI.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [view, setView] = useState('GAME'); // GAME o INVENTORY
            const [stats, setStats] = useState({
                level: 1, xp: 0, xpMax: 100, gold: 100,
                STR: 15, DEX: 15, SAG: 15, VIT: 15, // Statistiche base
                hp: 100, hpMax: 100, atk: 10, def: 5, stam: 100
            });
            const [equipment, setEquipment] = useState({
                head: null, shoulders: null, torso: null, back: null,
                hands: null, legs: null, feet: null, neck: null,
                ring1: null, ring2: null, weapon: null
            });
            const [inventory, setInventory] = useState([]);
            const [logs, setLogs] = useState(["Benvenuto nel tuo Destino..."]);

            // Funzione per gestire il rilascio degli oggetti (Drop Loot)
            const dropLoot = (lvl) => {
                const newItem = generateItem(lvl);
                
                // Se lo slot √® vuoto, equipaggia automaticamente
                if (!equipment[newItem.slot]) {
                    setEquipment(prev => ({ ...prev, [newItem.slot]: newItem }));
                    setLogs(prev => [`Nuovo oggetto equipaggiato: ${newItem.name}`, ...prev]);
                } else {
                    // Altrimenti metti nello zaino
                    setInventory(prev => [newItem, ...prev]);
                    setLogs(prev => [`Hai trovato: ${newItem.name}!`, ...prev]);
                }
            };

            // Funzione per equipaggiare manualmente dallo zaino
            const handleEquip = (item) => {
                const currentStat = stats[item.requirement.stat];
                if (currentStat < item.requirement.value) {
                    alert(`Requisiti non soddisfatti! Ti serve ${item.requirement.value} di ${item.requirement.stat}`);
                    return;
                }

                // Scambia l'oggetto vecchio con quello nuovo nell'inventario
                const oldItem = equipment[item.slot];
                setEquipment(prev => ({ ...prev, [item.slot]: item }));
                setInventory(prev => {
                    const filtered = prev.filter(i => i.id !== item.id);
                    return oldItem ? [oldItem, ...filtered] : filtered;
                });
            };

            return (
                <div className="relative w-full h-screen bg-zinc-950 overflow-hidden">
                    {/* HUD SEMPLICE */}
                    <div className="absolute top-0 w-full p-4 flex justify-between items-start z-50">
                        <div className="bg-black/80 border-2 border-red-900 p-4 w-64">
                            <div className="text-red-500 text-xl font-bold">EROE LVL {stats.level}</div>
                            <div className="text-xs text-gray-400">HP: {stats.hp}/{stats.hpMax}</div>
                            <div className="w-full h-2 bg-gray-800 mt-1"><div className="h-full bg-red-600" style={{width:'100%'}}/></div>
                        </div>
                        
                        <div className="flex flex-col gap-2 items-end">
                            <button 
                                onClick={() => setView('INVENTORY')}
                                className="bg-yellow-700 hover:bg-yellow-600 text-white px-6 py-3 border-2 border-yellow-900 shadow-lg text-xl"
                            >
                                APRI ZAINO ({inventory.length})
                            </button>
                            <button 
                                onClick={() => dropLoot(stats.level)}
                                className="bg-blue-900 hover:bg-blue-800 text-white px-4 py-1 text-sm border border-blue-400"
                            >
                                SIMULA DROP MOSTRO
                            </button>
                        </div>
                    </div>

                    {/* AREA DI GIOCO (MOCKUP) */}
                    <div className="flex flex-col items-center justify-center h-full">
                        <div className="text-9xl mb-10 opacity-20">üõ°Ô∏è</div>
                        <div className="text-gray-500 italic text-xl">Il personaggio sta correndo...</div>
                        
                        {/* LOGS */}
                        <div className="mt-10 w-full max-w-md bg-black/40 p-4 rounded h-32 overflow-y-auto border border-white/5">
                            {logs.map((log, i) => (
                                <div key={i} className="text-sm py-1 border-b border-white/5 text-gray-300">
                                    {log}
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* OVERLAY INVENTARIO */}
                    {view === 'INVENTORY' && (
                        <EquipmentScreen 
                            stats={stats}
                            equipment={equipment}
                            inventory={inventory}
                            onEquip={handleEquip}
                            onClose={() => setView('GAME')}
                        />
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
